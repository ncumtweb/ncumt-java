<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{/layout/main.html}">

<body>

<main layout:fragment="content">
    <!-- ======= Hero Slider Section ======= -->
    <section id="hero-slider" class="hero-slider">
        <div class="container-md" data-aos="fade-in">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="swiper sliderFeaturedPosts">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" th:each="record : ${recordList}">
                                <a th:href="@{|/record/${record.id}|}"
                                   class="img-bg d-flex align-items-end"
                                   th:style="|background-image: url('${record.image}');|"
                                   loading="lazy">
                                    <div class="img-bg-inner">
                                        <h2 th:text="${record.startDate} + ' - ' + ${record.endDate}"></h2>
                                        <h2 th:text="${record.name}"></h2>
                                        <p th:text="${record.description}"></p>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="custom-swiper-button-next"><span class="bi-chevron-right"></span></div>
                        <div class="custom-swiper-button-prev"><span class="bi-chevron-left"></span></div>
                        <div class="swiper-pagination"></div>
                    </div>
                </div>
            </div>
        </div>
    </section><!-- End Hero Slider Section -->

    <!-- ======= Post Section (Refactored) ======= -->
    <section class="mb-5">
        <div class="container" data-aos="fade-up">
            <div class="row">
                <div class="col-lg-12">
                    <div class="d-flex justify-content-center align-items-baseline">
                        <h1 class="page-title">公告</h1>
                        <a class="btn btn-primary ms-3" th:href="@{/post/list}">所有公告</a>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="alert alert-info text-center" role="alert" th:if="${postPage.isEmpty()}">
                        目前沒有任何公告
                    </div>

                    <div class="table-responsive" th:unless="${postPage.isEmpty()}">
                        <table class="table table-hover" style="font-size:20px;">
                            <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">類別</th>
                                <th scope="col">標題</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:data-bs-target="${'#modal-' + post.id}"
                                style="cursor: pointer;" th:data-bs-toggle="modal"
                                th:each="post, iterStat : ${postPage.content}">
                                <td class="postshow">
                                    <i class="bi bi-pin-angle-fill" th:if="${post.pin == 1}"></i>
                                    <i class="bi bi-card-text" th:if="${post.pin != 1}"></i>
                                    <span th:text="${iterStat.count}"></span>
                                </td>
                                <td>
                                    <span class="badge"
                                          th:style="|background-color: ${post.color}; color:black;|"
                                          th:text="${post.typeName}"></span>
                                </td>
                                <td th:text="${post.title}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination Component -->
                    <div th:replace="~{fragments/pagination :: pagination(page=${postPage}, url=@{/})}"></div>
                </div>
            </div>
        </div>
    </section><!-- End Post Section -->

    <!-- ======= Calendar Section ======= -->
    <div class="container-md" data-aos="fade-in">
        <div class="row justify-content-center">
            <div class="col-lg-12 mb-5">
                <h1 class="page-title text-center mb-4">山社行事曆</h1>
                <div id="calendar"></div>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal fade" id="calendarEvent" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <!-- ... (content) ... -->
    </div><!-- End Event Modal -->

    <!-- Modals for Posts (Moved to top level) -->
    <div th:each="post : ${postPage.content}">
        <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" role="dialog"
             tabindex="-1" th:id="${'modal-' + post.id}">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" th:text="${post.title}"></h5>
                        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" onclick="this.blur();"
                                type="button"></button>
                    </div>
                    <div class="modal-body" th:utext="${post.content}"></div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" data-bs-dismiss="modal" onclick="this.blur();" type="button">
                            關閉
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        window.calendarConfig = {
            events: [[${calendarEventList}]],
            editUrlTemplate: /*[[@{/calendar/edit/{id}(id=':id')}]]*/
        };
    </script>
    <script th:src="@{/assets/js/calendar.js}"></script>

</main>

</body>
</html>